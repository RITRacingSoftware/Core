<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Core: /home/matthias/racing/core/src/driver/Src/adc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="register_tables.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Core
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_4db3a2f7aa3a8b9901e70dfeb2571af9.html">driver</a></li><li class="navelem"><a class="el" href="dir_bd43694d282a1a6821503b447b4f5643.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">adc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Core ADC library.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;adc.h&quot;</code><br />
<code>#include &quot;core_config.h&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stm32g4xx_hal.h&gt;</code><br />
<code>#include &lt;stm32g4xx_hal_adc.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;gpio.h&quot;</code><br />
<code>#include &quot;clock.h&quot;</code><br />
<code>#include &quot;error_handler.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a621a15aeabffa62cc698e79224fb5985"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8c.html#a621a15aeabffa62cc698e79224fb5985">core_ADC_init</a> (ADC_TypeDef *adc)</td></tr>
<tr class="memdesc:a621a15aeabffa62cc698e79224fb5985"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize an ADC module, including its clock. Also performs calibration. GPIO ports are not initialized.  <a href="adc_8c.html#a621a15aeabffa62cc698e79224fb5985">More...</a><br /></td></tr>
<tr class="separator:a621a15aeabffa62cc698e79224fb5985"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae013346221e7d8ad7c08230899a8b09a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8c.html#ae013346221e7d8ad7c08230899a8b09a">core_ADC_setup_pin</a> (GPIO_TypeDef *port, uint32_t pin, uint8_t opamp)</td></tr>
<tr class="memdesc:ae013346221e7d8ad7c08230899a8b09a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up a pin as an analog input.  <a href="adc_8c.html#ae013346221e7d8ad7c08230899a8b09a">More...</a><br /></td></tr>
<tr class="separator:ae013346221e7d8ad7c08230899a8b09a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3334b39ee94f9f9c300ac81b88848a2e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8c.html#a3334b39ee94f9f9c300ac81b88848a2e">core_ADC_read_channel</a> (GPIO_TypeDef *port, uint32_t pin, uint16_t *result)</td></tr>
<tr class="memdesc:a3334b39ee94f9f9c300ac81b88848a2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the value of an analog input as a value between 0 and 4095.  <a href="adc_8c.html#a3334b39ee94f9f9c300ac81b88848a2e">More...</a><br /></td></tr>
<tr class="separator:a3334b39ee94f9f9c300ac81b88848a2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Core ADC library. </p>
<p>This core library component is used to initialize ADCs and read from analog inputs.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Initialization</h2>
<p>Before initializing any pins, the user code must initialize one or more ADC modules.</p>
<p>To initialize a pin, the user code calls <a class="el" href="adc_8c.html#ae013346221e7d8ad7c08230899a8b09a" title="Set up a pin as an analog input.">core_ADC_setup_pin()</a>. This function takes the port and pin number as well as a third argument specifying whether the analog signal should be routed through an internal op amp follower circuit. This will improve the accuracy of the measurement when the analog input is fed from a high-impedance source</p>
<p>If <a class="el" href="adc_8c.html#ae013346221e7d8ad7c08230899a8b09a" title="Set up a pin as an analog input.">core_ADC_setup_pin()</a> returns 0, then the desired pin cannot be connected to any of the ADCs that are currently initialized. It may be necessary to initialize an additional ADC module or change the pin the analog input is connected to.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Reading</h2>
<p>To read from an analog input, the user code calls <a class="el" href="adc_8c.html#a3334b39ee94f9f9c300ac81b88848a2e" title="Read the value of an analog input as a value between 0 and 4095.">core_ADC_read_channel()</a>. The result is stored in a pointer passed as an argument, and the return value specifies whether the conversion was successful or not. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a621a15aeabffa62cc698e79224fb5985"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a621a15aeabffa62cc698e79224fb5985">&#9670;&nbsp;</a></span>core_ADC_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool core_ADC_init </td>
          <td>(</td>
          <td class="paramtype">ADC_TypeDef *&#160;</td>
          <td class="paramname"><em>adc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize an ADC module, including its clock. Also performs calibration. GPIO ports are not initialized. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">adc</td><td>The ADC module to initialize </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>if adc is not a valid ADC module or if the ADC fails to initialize </td></tr>
    <tr><td class="paramname">1</td><td>otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3334b39ee94f9f9c300ac81b88848a2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3334b39ee94f9f9c300ac81b88848a2e">&#9670;&nbsp;</a></span>core_ADC_read_channel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool core_ADC_read_channel </td>
          <td>(</td>
          <td class="paramtype">GPIO_TypeDef *&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the value of an analog input as a value between 0 and 4095. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>GPIO port of the pin to be read (GPIOx) </td></tr>
    <tr><td class="paramname">pin</td><td>Pin number of the pin to be read (GPIO_PIN_x) </td></tr>
    <tr><td class="paramname">result</td><td>Location to which the result should be stored </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>if the given pin is not an analog input or if the corresponding ADC module is not initialized or if an error occurs while reading, </td></tr>
    <tr><td class="paramname">1</td><td>otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae013346221e7d8ad7c08230899a8b09a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae013346221e7d8ad7c08230899a8b09a">&#9670;&nbsp;</a></span>core_ADC_setup_pin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool core_ADC_setup_pin </td>
          <td>(</td>
          <td class="paramtype">GPIO_TypeDef *&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>opamp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up a pin as an analog input. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>GPIO port (GPIOx) </td></tr>
    <tr><td class="paramname">pin</td><td>GPIO pin (GPIO_PIN_x) </td></tr>
    <tr><td class="paramname">opamp</td><td>1 if the input should be routed through an opamp, 0 otherwise </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>if a configuration was found for the given pin </td></tr>
    <tr><td class="paramname">0</td><td>otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
