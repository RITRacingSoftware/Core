\doxysection{/\+Users/solomonshulman/\+RITRacing/\+Core/src/driver/\+Src/adc.c File Reference}
\hypertarget{adc_8c}{}\label{adc_8c}\index{/Users/solomonshulman/RITRacing/Core/src/driver/Src/adc.c@{/Users/solomonshulman/RITRacing/Core/src/driver/Src/adc.c}}


Core ADC library.  


{\ttfamily \#include "{}adc.\+h"{}}\newline
{\ttfamily \#include "{}core\+\_\+config.\+h"{}}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include $<$stm32g4xx\+\_\+hal.\+h$>$}\newline
{\ttfamily \#include $<$stm32g4xx\+\_\+hal\+\_\+adc.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include "{}gpio.\+h"{}}\newline
{\ttfamily \#include "{}clock.\+h"{}}\newline
{\ttfamily \#include "{}error\+\_\+handler.\+h"{}}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{adc_8c_a621a15aeabffa62cc698e79224fb5985}{core\+\_\+\+ADC\+\_\+init}} (ADC\+\_\+\+Type\+Def \texorpdfstring{$\ast$}{*}adc)
\begin{DoxyCompactList}\small\item\em Initialize an ADC module, including its clock. Also performs calibration. GPIO ports are not initialized. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{adc_8c_ae013346221e7d8ad7c08230899a8b09a}{core\+\_\+\+ADC\+\_\+setup\+\_\+pin}} (GPIO\+\_\+\+Type\+Def \texorpdfstring{$\ast$}{*}port, uint32\+\_\+t pin, uint8\+\_\+t opamp)
\begin{DoxyCompactList}\small\item\em Set up a pin as an analog input. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{adc_8c_a3334b39ee94f9f9c300ac81b88848a2e}{core\+\_\+\+ADC\+\_\+read\+\_\+channel}} (GPIO\+\_\+\+Type\+Def \texorpdfstring{$\ast$}{*}port, uint32\+\_\+t pin, uint16\+\_\+t \texorpdfstring{$\ast$}{*}result)
\begin{DoxyCompactList}\small\item\em Read the value of an analog input as a value between 0 and 4095. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Core ADC library. 

This core library component is used to initialize ADCs and read from analog inputs.\hypertarget{adc_8c_autotoc_md0}{}\doxysubsubsection{\texorpdfstring{Initialization}{Initialization}}\label{adc_8c_autotoc_md0}
Before initializing any pins, the user code must initialize one or more ADC modules.

To initialize a pin, the user code calls \doxylink{adc_8c_ae013346221e7d8ad7c08230899a8b09a}{core\+\_\+\+ADC\+\_\+setup\+\_\+pin()}. This function takes the port and pin number as well as a third argument specifying whether the analog signal should be routed through an internal op amp follower circuit. This will improve the accuracy of the measurement when the analog input is fed from a high-\/impedance source

If \doxylink{adc_8c_ae013346221e7d8ad7c08230899a8b09a}{core\+\_\+\+ADC\+\_\+setup\+\_\+pin()} returns 0, then the desired pin cannot be connected to any of the ADCs that are currently initialized. It may be necessary to initialize an additional ADC module or change the pin the analog input is connected to.\hypertarget{adc_8c_autotoc_md1}{}\doxysubsubsection{\texorpdfstring{Reading}{Reading}}\label{adc_8c_autotoc_md1}
To read from an analog input, the user code calls \doxylink{adc_8c_a3334b39ee94f9f9c300ac81b88848a2e}{core\+\_\+\+ADC\+\_\+read\+\_\+channel()}. The result is stored in a pointer passed as an argument, and the return value specifies whether the conversion was successful or not. 

\doxysubsection{Function Documentation}
\Hypertarget{adc_8c_a621a15aeabffa62cc698e79224fb5985}\index{adc.c@{adc.c}!core\_ADC\_init@{core\_ADC\_init}}
\index{core\_ADC\_init@{core\_ADC\_init}!adc.c@{adc.c}}
\doxysubsubsection{\texorpdfstring{core\_ADC\_init()}{core\_ADC\_init()}}
{\footnotesize\ttfamily \label{adc_8c_a621a15aeabffa62cc698e79224fb5985} 
bool core\+\_\+\+ADC\+\_\+init (\begin{DoxyParamCaption}\item[{ADC\+\_\+\+Type\+Def \texorpdfstring{$\ast$}{*}}]{adc}{}\end{DoxyParamCaption})}



Initialize an ADC module, including its clock. Also performs calibration. GPIO ports are not initialized. 


\begin{DoxyParams}{Parameters}
{\em adc} & The ADC module to initialize \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & if adc is not a valid ADC module or if the ADC fails to initialize \\
\hline
{\em 1} & otherwise. \\
\hline
\end{DoxyRetVals}
\Hypertarget{adc_8c_a3334b39ee94f9f9c300ac81b88848a2e}\index{adc.c@{adc.c}!core\_ADC\_read\_channel@{core\_ADC\_read\_channel}}
\index{core\_ADC\_read\_channel@{core\_ADC\_read\_channel}!adc.c@{adc.c}}
\doxysubsubsection{\texorpdfstring{core\_ADC\_read\_channel()}{core\_ADC\_read\_channel()}}
{\footnotesize\ttfamily \label{adc_8c_a3334b39ee94f9f9c300ac81b88848a2e} 
bool core\+\_\+\+ADC\+\_\+read\+\_\+channel (\begin{DoxyParamCaption}\item[{GPIO\+\_\+\+Type\+Def \texorpdfstring{$\ast$}{*}}]{port}{, }\item[{uint32\+\_\+t}]{pin}{, }\item[{uint16\+\_\+t \texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}



Read the value of an analog input as a value between 0 and 4095. 


\begin{DoxyParams}{Parameters}
{\em port} & GPIO port of the pin to be read (GPIOx) \\
\hline
{\em pin} & Pin number of the pin to be read (GPIO\+\_\+\+PIN\+\_\+x) \\
\hline
{\em result} & Location to which the result should be stored \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & if the given pin is not an analog input or if the corresponding ADC module is not initialized or if an error occurs while reading, \\
\hline
{\em 1} & otherwise \\
\hline
\end{DoxyRetVals}
\Hypertarget{adc_8c_ae013346221e7d8ad7c08230899a8b09a}\index{adc.c@{adc.c}!core\_ADC\_setup\_pin@{core\_ADC\_setup\_pin}}
\index{core\_ADC\_setup\_pin@{core\_ADC\_setup\_pin}!adc.c@{adc.c}}
\doxysubsubsection{\texorpdfstring{core\_ADC\_setup\_pin()}{core\_ADC\_setup\_pin()}}
{\footnotesize\ttfamily \label{adc_8c_ae013346221e7d8ad7c08230899a8b09a} 
bool core\+\_\+\+ADC\+\_\+setup\+\_\+pin (\begin{DoxyParamCaption}\item[{GPIO\+\_\+\+Type\+Def \texorpdfstring{$\ast$}{*}}]{port}{, }\item[{uint32\+\_\+t}]{pin}{, }\item[{uint8\+\_\+t}]{opamp}{}\end{DoxyParamCaption})}



Set up a pin as an analog input. 


\begin{DoxyParams}{Parameters}
{\em port} & GPIO port (GPIOx) \\
\hline
{\em pin} & GPIO pin (GPIO\+\_\+\+PIN\+\_\+x) \\
\hline
{\em opamp} & 1 if the input should be routed through an opamp, 0 otherwise \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 1} & if a configuration was found for the given pin \\
\hline
{\em 0} & otherwise \\
\hline
\end{DoxyRetVals}
